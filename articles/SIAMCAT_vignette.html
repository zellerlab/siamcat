<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIAMCAT: Statistical Inference of Associations between Microbial Communities And host phenoTypes • SIAMCAT</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SIAMCAT: Statistical Inference of Associations between Microbial Communities And host phenoTypes">
<meta property="og:description" content="SIAMCAT">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//tr-denbi.embl.de/heimdall/";
    _paq.push(['setTrackerUrl', u+'p.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'p.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SIAMCAT</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/SIAMCAT_vignette.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/SIAMCAT_vignette.html">Introduction to SIAMCAT</a>
    </li>
    <li>
      <a href="../articles/SIAMCAT_confounder.html">SIAMCAT example with confounders</a>
    </li>
    <li>
      <a href="../articles/SIAMCAT_holdout.html">Holdout testing with SIAMCAT</a>
    </li>
    <li>
      <a href="../articles/SIAMCAT_meta.html">SIAMCAT machine learning meta-analysis</a>
    </li>
    <li>
      <a href="../articles/SIAMCAT_ml_pitfalls.html">Machine learning pitfalls</a>
    </li>
    <li>
      <a href="../articles/SIAMCAT_read-in.html">SIAMCAT input formats</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/siamcat_dev">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/zellerlab/siamcat">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="SIAMCAT_vignette_files/header-attrs-2.5/header-attrs.js"></script><script src="SIAMCAT_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="SIAMCAT_vignette_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="SIAMCAT_vignette_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      
      <div class="hidden name"><code>SIAMCAT_vignette.Rmd</code></div>

    </div>

    
    
<div id="about-this-vignette" class="section level1">
<h1 class="hasAnchor">
<a href="#about-this-vignette" class="anchor"></a>About This Vignette</h1>
<p>This vignette aims to be a short tutorial for the main functionalities of <code>SIAMCAT</code>. Examples of additional workflows or more detailed tutorials can be found in other vignettes (see the <a href="https://bioconductor.org/packages/SIAMCAT">BioConductor page</a>).</p>
<p><code>SIAMCAT</code> is part of the suite of computational microbiome analysis tools hosted at <a href="https://www.embl.org">EMBL</a> by the groups of <a href="https://www.embl.de/research/units/scb/bork/index.html">Peer Bork</a> and <a href="https://www.embl.de/research/units/scb/zeller/index.html">Georg Zeller</a>. Find out more at <a href="http://microbiome-tools.embl.de/">EMBL-microbiome tools</a>.</p>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Associations between microbiome and host phenotypes are ideally described by quantitative models able to predict host status from microbiome composition. <code>SIAMCAT</code> can do so for data from hundreds of thousands of microbial taxa, gene families, or metabolic pathways over hundreds of samples. <code>SIAMCAT</code> produces graphical output for convenient assessment of the quality of the input data and statistical associations, for model diagnostics and inference revealing the most predictive microbial biomarkers.</p>
</div>
<div id="quick-start" class="section level1">
<h1 class="hasAnchor">
<a href="#quick-start" class="anchor"></a>Quick Start</h1>
<p>For this vignette, we use an example dataset included in the <code>SIAMCAT</code> package. As example dataset we use the data from the publication of <a href="http://europepmc.org/abstract/MED/25432777">Zeller et al</a>, which demonstrated the potential of microbial species in fecal samples to distinguish patients with colorectal cancer (CRC) from healthy controls.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"SIAMCAT"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"feat_crc_zeller"</span>, package<span class="op">=</span><span class="st">"SIAMCAT"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"meta_crc_zeller"</span>, package<span class="op">=</span><span class="st">"SIAMCAT"</span><span class="op">)</span></code></pre></div>
<p>First, <code>SIAMCAT</code> needs a feature matrix (can be either a <code>matrix</code>, a <code>data.frame</code>, or a <code>phyloseq-otu_table</code>), which contains values of different features (in rows) for different samples (in columns). For example, the feature matrix included here contains relative abundances for bacterial species calculated with the <a href="motu-tool.org">mOTU profiler</a> for 141 samples:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">feat.crc.zeller</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></code></pre></div>
<pre><code>##                                  CCIS27304052ST-3-0 CCIS15794887ST-4-0
## UNMAPPED                                   0.589839          0.7142157
## Methanoculleus marisnigri [h:1]            0.000000          0.0000000
## Methanococcoides burtonii [h:10]           0.000000          0.0000000
##                                  CCIS74726977ST-3-0
## UNMAPPED                                  0.7818674
## Methanoculleus marisnigri [h:1]           0.0000000
## Methanococcoides burtonii [h:10]          0.0000000</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">feat.crc.zeller</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1754  141</code></pre>
<blockquote>
<p>Please note that <code>SIAMCAT</code> is supposed to work with <strong>relative abundances</strong>. Other types of data (e.g. counts) will also work, but not all functions of the package will result in meaningful outputs.</p>
</blockquote>
<p>Secondly, we also have metadata about the samples in another <code>data.frame</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">meta.crc.zeller</span><span class="op">)</span></code></pre></div>
<pre><code>##                    Age BMI Gender AJCC_stage     FOBT Group
## CCIS27304052ST-3-0  52  20      F         -1 Negative   CTR
## CCIS15794887ST-4-0  37  18      F         -1 Negative   CTR
## CCIS74726977ST-3-0  66  24      M         -1 Negative   CTR
## CCIS16561622ST-4-0  54  26      M         -1 Negative   CTR
## CCIS79210440ST-3-0  65  30      M         -1 Positive   CTR
## CCIS82507866ST-3-0  57  24      M         -1 Negative   CTR</code></pre>
<p>In order to tell <code>SIAMCAT</code>, which samples are cancer cases and which are healthy controls, we can construct a label object from the <code>Group</code> column in the metadata.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">label.crc.zeller</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.label.html">create.label</a></span><span class="op">(</span>meta<span class="op">=</span><span class="va">meta.crc.zeller</span>,
    label<span class="op">=</span><span class="st">'Group'</span>, case<span class="op">=</span><span class="st">'CRC'</span><span class="op">)</span></code></pre></div>
<pre><code>## Label used as case:
##    CRC
## Label used as control:
##    CTR</code></pre>
<pre><code>## + finished create.label.from.metadata in 0.002 s</code></pre>
<p>Now we have all the ingredients to create a <code>SIAMCAT</code> object. Please have a look at the <a href="SIAMCAT_read-in.html">vignette about input formats</a> for more information about supported formats and other ways to create a <code>SIAMCAT</code> object.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/siamcat.html">siamcat</a></span><span class="op">(</span>feat<span class="op">=</span><span class="va">feat.crc.zeller</span>,
    label<span class="op">=</span><span class="va">label.crc.zeller</span>,
    meta<span class="op">=</span><span class="va">meta.crc.zeller</span><span class="op">)</span></code></pre></div>
<pre><code>## + starting validate.data</code></pre>
<pre><code>## +++ checking overlap between labels and features</code></pre>
<pre><code>## + Keeping labels of 141 sample(s).</code></pre>
<pre><code>## +++ checking sample number per class</code></pre>
<pre><code>## +++ checking overlap between samples and metadata</code></pre>
<pre><code>## + finished validate.data in 0.088 s</code></pre>
<p>A few information about the <code>SIAMCAT</code> object can be accessed with the <code>show</code> function from <code>phyloseq</code> (<code>SIAMCAT</code> builds on the <code>phyloseq</code> data structure):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">show</span><span class="op">(</span><span class="va">sc.obj</span><span class="op">)</span></code></pre></div>
<pre><code>## siamcat-class object
## label()                Label object:         88 CTR and 53 CRC samples
## 
## contains phyloseq-class experiment-level object @phyloseq:
## phyloseq@otu_table()   OTU Table:            [ 1754 taxa and 141 samples ]
## phyloseq@sam_data()    Sample Data:          [ 141 samples by 6 sample variables ]</code></pre>
<p>Since we have quite a lot of microbial species in the dataset at the moment, we can perform unsupervised feature selection using the function <code>filter.features</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter.features.html">filter.features</a></span><span class="op">(</span><span class="va">sc.obj</span>,
    filter.method <span class="op">=</span> <span class="st">'abundance'</span>,
    cutoff <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></code></pre></div>
<pre><code>## Features successfully filtered</code></pre>
</div>
<div id="association-testing" class="section level1">
<h1 class="hasAnchor">
<a href="#association-testing" class="anchor"></a>Association Testing</h1>
<p>Associations between microbial species and the label can be tested with the <code>check.associations</code> function. The function computes for each species the significance using a non-parametric Wilcoxon test and different effect sizes for the association (e.g. AUC or fold change).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check.associations.html">check.associations</a></span><span class="op">(</span>
    <span class="va">sc.obj</span>,
    sort.by <span class="op">=</span> <span class="st">'fc'</span>,
    alpha <span class="op">=</span> <span class="fl">0.05</span>,
    mult.corr <span class="op">=</span> <span class="st">"fdr"</span>,
    detect.lim <span class="op">=</span> <span class="fl">10</span> <span class="op">^</span><span class="op">-</span><span class="fl">6</span>,
    plot.type <span class="op">=</span> <span class="st">"quantile.box"</span>,
    panels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"fc"</span>, <span class="st">"prevalence"</span>, <span class="st">"auroc"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The function produces a pdf file as output, since the plot is optimized for a landscape DIN-A4 layout, but can also used to plot on an active graphic device, e.g. in RStudio. The resulting plot then looks like that: <img src="associations_plot.png" alt="Association Plot"></p>
</div>
<div id="confounder-testing" class="section level1">
<h1 class="hasAnchor">
<a href="#confounder-testing" class="anchor"></a>Confounder Testing</h1>
<p>As many biological and technical factors beyond the primary phenotype of interest can influence microbiome composition, simple association studies may suffer confounding by other variables, which can lead to spurious results. The <code>check.confounders</code> function provides the option to test the associated metadata variables for potential confounding influence. No information is stored in the <code>SIAMCAT</code> object, but the different analyses are visualized and saved to a combined pdf file for qualitative interpretation.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check.confounders.html">check.confounders</a></span><span class="op">(</span>
    <span class="va">sc.obj</span>,
    fn.plot <span class="op">=</span> <span class="st">'confounder_plots.pdf'</span>,
    meta.in <span class="op">=</span> <span class="cn">NULL</span>,
    feature.type <span class="op">=</span> <span class="st">'filtered'</span>
<span class="op">)</span></code></pre></div>
<p>The conditional entropy check primarily serves to remove nonsensical variables from subsequent checks. Conditional entropy quantifies the unique information contained in one variable (row) respective to another (column). Identical variables and derived variables which share the exact same information will have a value of zero. In this example, the label was derived from the Group variable which was determined from AJCC stage, so both are excluded.</p>
<div class="figure">
<img src="confounder_entropy_plot.png" alt=""><p class="caption">Conditional Entropy Plot</p>
</div>
<p>To better quantify potential confounding effects of metadata variables on individual microbial features, <code>check.confounder</code> plots the variance explained by the label in comparison with the variance explained by the metadata variable for each individual feature. Variables with many features in the upper left corner might be confounding the label associations.</p>
<div class="figure">
<img src="confounder_anova_plot.png" alt=""><p class="caption">Variance Explained Plot</p>
</div>
</div>
<div id="model-building" class="section level1">
<h1 class="hasAnchor">
<a href="#model-building" class="anchor"></a>Model Building</h1>
<p>One strength of <code>SIAMCAT</code> is the versatile but easy-to-use interface for the construction of machine learning models on the basis of microbial species. <code>SIAMCAT</code> contains functions for data normalization, splitting the data into cross-validation folds, training the model, and making predictions based on cross-validation instances and the trained models.</p>
<div id="data-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#data-normalization" class="anchor"></a>Data Normalization</h2>
<p>Data normalization is performed with the <code>normalize.features</code> function. Here, we use the <code>log.unit</code> method, but several other methods and customization options are available (please check the documentation).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalize.features.html">normalize.features</a></span><span class="op">(</span>
    <span class="va">sc.obj</span>,
    norm.method <span class="op">=</span> <span class="st">"log.unit"</span>,
    norm.param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        log.n0 <span class="op">=</span> <span class="fl">1e-06</span>,
        n.p <span class="op">=</span> <span class="fl">2</span>,
        norm.margin <span class="op">=</span> <span class="fl">1</span>
    <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## Features normalized successfully.</code></pre>
</div>
<div id="prepare-cross-validation" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-cross-validation" class="anchor"></a>Prepare Cross-Validation</h2>
<p>Preparation of the cross-validation fold is a crucial step in machine learning. <code>SIAMCAT</code> greatly simplifies the set-up of cross-validation schemes, including stratification of samples or keeping samples inseperable based on metadata. For this small example, we choose a twice-repeated 5-fold cross-validation scheme. The data-split will be saved in the <code>data_split</code> slot of the <code>SIAMCAT</code> object.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc.obj</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/create.data.split.html">create.data.split</a></span><span class="op">(</span>
    <span class="va">sc.obj</span>,
    num.folds <span class="op">=</span> <span class="fl">5</span>,
    num.resample <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span></code></pre></div>
<pre><code>## Features splitted for cross-validation successfully.</code></pre>
</div>
<div id="model-training" class="section level2">
<h2 class="hasAnchor">
<a href="#model-training" class="anchor"></a>Model Training</h2>
<p>The actual model training is performed using the function <code>train.model</code>. Again, multiple options for customization are available, ranging from the machine learning method to the measure for model selection or customizable parameter set for hyperparameter tuning.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.model.html">train.model</a></span><span class="op">(</span>
    <span class="va">sc.obj</span>,
    method <span class="op">=</span> <span class="st">"lasso"</span>
<span class="op">)</span></code></pre></div>
<p>The models are saved in the <code>model_list</code> slot of the <code>SIAMCAT</code> object. The model building is performed using the <code>mlr</code> R package. All models can easily be accessed.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get information about the model type</span>
<span class="fu"><a href="../reference/model_type.html">model_type</a></span><span class="op">(</span><span class="va">sc.obj</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "lasso"</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># access the models</span>
<span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/models.html">models</a></span><span class="op">(</span><span class="va">sc.obj</span><span class="op">)</span>
<span class="va">models</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## Model for learner.id=classif.cvglmnet; learner.class=classif.cvglmnet
## Trained on: task.id = data; obs = 112; features = 207
## Hyperparameters: nlambda=100,alpha=1</code></pre>
</div>
<div id="make-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#make-predictions" class="anchor"></a>Make Predictions</h2>
<p>Using the data-split and the models trained in previous step, we can use the function <code>make.predictions</code> in order to apply the models on the test instances in the data-split. The predictions will be saved in the <code>pred_matrix</code> slot of the <code>SIAMCAT</code> object.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.predictions.html">make.predictions</a></span><span class="op">(</span><span class="va">sc.obj</span><span class="op">)</span>
<span class="va">pred_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_matrix.html">pred_matrix</a></span><span class="op">(</span><span class="va">sc.obj</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">pred_matrix</span><span class="op">)</span></code></pre></div>
<pre><code>##                       CV_rep1    CV_rep2
## CCIS27304052ST-3-0 0.14049650 0.23059690
## CCIS15794887ST-4-0 0.18919879 0.32750371
## CCIS74726977ST-3-0 0.41862575 0.31525733
## CCIS16561622ST-4-0 0.28153450 0.46632974
## CCIS79210440ST-3-0 0.06298804 0.02838844
## CCIS82507866ST-3-0 0.04717181 0.05472805</code></pre>
</div>
</div>
<div id="model-evaluation-and-interpretation" class="section level1">
<h1 class="hasAnchor">
<a href="#model-evaluation-and-interpretation" class="anchor"></a>Model Evaluation and Interpretation</h1>
<p>In the final part, we want to find out how well the model performed and which microbial species had been selected in the model. In order to do so, we first calculate how well the predictions fit the real data using the function <code>evaluate.predictions</code>. This function calculates the Area Under the Receiver Operating Characteristic (ROC) Curve (AU-ROC) and the Precision Recall (PR) Curve for each resampled cross-validation run.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sc.obj</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/evaluate.predictions.html">evaluate.predictions</a></span><span class="op">(</span><span class="va">sc.obj</span><span class="op">)</span></code></pre></div>
<pre><code>## Evaluated predictions successfully.</code></pre>
<div id="evaluation-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluation-plot" class="anchor"></a>Evaluation Plot</h2>
<p>To plot the results of the evaluation, we can use the function <code>model.evaluation.plot</code>, which produces a pdf-file showing the ROC and PR Curves for the different resamples runs as well as the mean ROC and PR Curve.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model.evaluation.plot.html">model.evaluation.plot</a></span><span class="op">(</span><span class="va">sc.obj</span><span class="op">)</span></code></pre></div>
<p><img src="eval_plot.png"></p>
</div>
<div id="interpretation-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#interpretation-plot" class="anchor"></a>Interpretation Plot</h2>
<p>The final plot produced by <code>SIAMCAT</code> is the model interpretation plot, created by the <code>model.interpretation.plot</code> function. The plot shows for the top selected features the</p>
<ul>
<li><p>model weights (and how robust they are) as a barplot,</p></li>
<li><p>a heatmap with the z-scores or fold changes for the top selected features, and</p></li>
<li><p>a boxplot showing the proportions of weight per model which is captured by the top selected features.</p></li>
</ul>
<p>Additionally, the distribution of metadata is shown in a heatmap below.</p>
<p>The function again produces a pdf-file optimized for a landscape DIN-A4 plotting region.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/model.interpretation.plot.html">model.interpretation.plot</a></span><span class="op">(</span>
    <span class="va">sc.obj</span>,
    fn.plot <span class="op">=</span> <span class="st">'interpretation.pdf'</span>,
    consens.thres <span class="op">=</span> <span class="fl">0.5</span>,
    norm.models <span class="op">=</span> <span class="cn">TRUE</span>,
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,
    heatmap.type <span class="op">=</span> <span class="st">'zscore'</span>,
<span class="op">)</span></code></pre></div>
<p>The resulting plot looks like this: <img src="interpretation_plot.png" alt="Model Interpretation Plot"></p>
</div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h1>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.5
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] SIAMCAT_1.11.0    phyloseq_1.32.0   mlr_2.18.0        ParamHelpers_1.14
## [5] BiocStyle_2.16.1 
## 
## loaded via a namespace (and not attached):
##  [1] nlme_3.1-150        matrixStats_0.57.0  fs_1.5.0           
##  [4] RColorBrewer_1.1-2  progress_1.2.2      PRROC_1.3.1        
##  [7] rprojroot_1.3-2     tools_4.0.2         backports_1.2.0    
## [10] R6_2.5.0            vegan_2.5-6         BiocGenerics_0.34.0
## [13] mgcv_1.8-33         colorspace_2.0-0    permute_0.9-5      
## [16] ade4_1.7-16         tidyselect_1.1.0    gridExtra_2.3      
## [19] prettyunits_1.1.1   compiler_4.0.2      parallelMap_1.5.0  
## [22] glmnet_4.0-2        textshaping_0.1.2   Biobase_2.48.0     
## [25] desc_1.2.0          bookdown_0.21       scales_1.1.1       
## [28] checkmate_2.0.0     pkgdown_1.6.1       systemfonts_0.3.2  
## [31] stringr_1.4.0       digest_0.6.27       rmarkdown_2.5      
## [34] XVector_0.28.0      pkgconfig_2.0.3     htmltools_0.5.0    
## [37] rlang_0.4.8         rstudioapi_0.12     BBmisc_1.11        
## [40] shape_1.4.5         generics_0.1.0      jsonlite_1.7.1     
## [43] dplyr_1.0.2         magrittr_1.5        biomformat_1.16.0  
## [46] Matrix_1.2-18       Rcpp_1.0.5          munsell_0.5.0      
## [49] S4Vectors_0.26.1    Rhdf5lib_1.10.1     ape_5.4-1          
## [52] lifecycle_0.2.0     infotheo_1.2.0      pROC_1.16.2        
## [55] stringi_1.5.3       yaml_2.2.1          MASS_7.3-53        
## [58] zlibbioc_1.34.0     rhdf5_2.32.4        plyr_1.8.6         
## [61] grid_4.0.2          LiblineaR_2.10-8    parallel_4.0.2     
## [64] crayon_1.3.4        lattice_0.20-41     Biostrings_2.56.0  
## [67] splines_4.0.2       multtest_2.44.0     hms_0.5.3          
## [70] knitr_1.30          beanplot_1.2        pillar_1.4.6       
## [73] igraph_1.2.6        reshape2_1.4.4      codetools_0.2-18   
## [76] stats4_4.0.2        fastmatch_1.1-0     XML_3.99-0.5       
## [79] glue_1.4.2          evaluate_0.14       data.table_1.13.2  
## [82] BiocManager_1.30.10 vctrs_0.3.4         foreach_1.5.1      
## [85] gtable_0.3.0        purrr_0.3.4         assertthat_0.2.1   
## [88] ggplot2_3.3.2       xfun_0.19           gridBase_0.4-7     
## [91] ragg_0.4.0          survival_3.2-7      tibble_3.0.4       
## [94] iterators_1.0.13    memoise_1.1.0       IRanges_2.22.2     
## [97] cluster_2.1.0       corrplot_0.84       ellipsis_0.3.1</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Konrad Zych, Jakob Wirbel, Georg Zeller.</p>
</div>

<div class="privacy">
  <p><strong>Privacy:</strong> Usage of this site follows
      <a href="https://www.embl.de/aboutus/privacy_policy/index.html">EMBL’s Privacy Policy</a><br>
      In accordance with that policy, we use Matomo to collect anonymised data on visits to, downloads from, and searches of this site.
      Contact <a href="mailto:zeller@embl.de">Georg Zeller</a> for details.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
