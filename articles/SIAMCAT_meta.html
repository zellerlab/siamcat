<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meta-analysis using SIAMCAT • SIAMCAT</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Meta-analysis using SIAMCAT">
<meta property="og:description" content="SIAMCAT">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//tr-denbi.embl.de/heimdall/";
    _paq.push(['setTrackerUrl', u+'p.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'p.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SIAMCAT</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/SIAMCAT_vignette.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/SIAMCAT_vignette.html">Introduction to SIAMCAT</a>
    </li>
    <li>
      <a href="../articles/SIAMCAT_confounder.html">SIAMCAT example with confounders</a>
    </li>
    <li>
      <a href="../articles/SIAMCAT_holdout.html">Holdout testing with SIAMCAT</a>
    </li>
    <li>
      <a href="../articles/SIAMCAT_meta.html">SIAMCAT machine learning meta-analysis</a>
    </li>
    <li>
      <a href="../articles/SIAMCAT_ml_pitfalls.html">Machine learning pitfalls</a>
    </li>
    <li>
      <a href="../articles/SIAMCAT_read-in.html">SIAMCAT input formats</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/zellerlab/siamcat" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Meta-analysis using SIAMCAT</h1>
                        <h4 data-toc-skip class="author">Jakob Wirbel,
and Georg Zeller</h4>
            <address class="author_afil">
      EMBL
Heidelberg<br><a class="author_email" href="mailto:#"></a><a href="mailto:georg.zeller@embl.de" class="email">georg.zeller@embl.de</a>
      </address>
                  
            <h4 data-toc-skip class="date">Date last modified:
2020-11-05</h4>
      
      
      <div class="hidden name"><code>SIAMCAT_meta.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="about-this-vignette">About This Vignette<a class="anchor" aria-label="anchor" href="#about-this-vignette"></a>
</h2>
<p>In this vignette, we want to demonstrate how <code>SIAMCAT</code> can
facilitate metagenomic meta-analyses, focussing both on association
testing and ML workflows. As an example, we use five different studies
of Crohn’s disease (CD), since we have taxonomic profiles from five
different metagenomic datasets available. Those studies are:</p>
<ol style="list-style-type: decimal">
<li><a href="htpps://doi.org/10.1038/nbt.2939">metaHIT</a></li>
<li><a href="https://doi.org/10.1016/j.chom.2015.09.008" class="external-link">Lewis et
al. 2015</a></li>
<li><a href="https://doi.org/10.1093/gigascience/gix050" class="external-link">He et
al. 2017</a></li>
<li><a href="https://doi.org/10.1038/s41564-018-0306-4" class="external-link">Franzosa et
al. 2019</a></li>
<li><a href="https://doi.org/10.1038/s41586-019-1237-9" class="external-link">HMP2</a></li>
</ol>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org" class="external-link">"tidyverse"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"SIAMCAT"</span><span class="op">)</span></span></code></pre></div>
<p>First, we load the data for all studies, which are available for
download from <a href="https://doi.org/10.5281/zenodo.7117162" class="external-link">Zenodo</a>. The raw data
have been preprocessed and taxonomically profiled with <a href="https://doi.org/10.1038/s41467-019-08844-4" class="external-link">mOTUs2</a> and were
then aggregated at genus level.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># base url for data download</span></span>
<span><span class="va">data.loc</span> <span class="op">&lt;-</span> <span class="st">'https://zenodo.org/api/files/d81e429c-870f-44e0-a44a-2a4aa541b6c1/'</span></span>
<span><span class="co"># datasets</span></span>
<span><span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'metaHIT'</span>, <span class="st">'Lewis_2015'</span>, <span class="st">'He_2017'</span>, <span class="st">'Franzosa_2019'</span>, <span class="st">'HMP2'</span><span class="op">)</span></span>
<span><span class="co"># metadata</span></span>
<span><span class="va">meta.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data.loc</span>, <span class="st">'meta_all_cd.tsv'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># features</span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data.loc</span>, <span class="st">'feat_genus_cd.tsv'</span><span class="op">)</span>, </span>
<span>                check.names <span class="op">=</span> <span class="cn">FALSE</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, quote <span class="op">=</span> <span class="st">''</span>, </span>
<span>                sep<span class="op">=</span><span class="st">'\t'</span><span class="op">)</span></span>
<span><span class="va">feat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">feat</span><span class="op">)</span></span>
<span><span class="co"># check that metadata and features agree</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">feat</span><span class="op">)</span> <span class="op">==</span> <span class="va">meta.all</span><span class="op">$</span><span class="va">Sample_ID</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let us have a look at the distribution of groups across the
studies</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">meta.all</span><span class="op">$</span><span class="va">Study</span>, <span class="va">meta.all</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span>
<span><span class="co">##                </span></span>
<span><span class="co">##                  CD CTR</span></span>
<span><span class="co">##   Franzosa_2019  88  56</span></span>
<span><span class="co">##   He_2017        49  53</span></span>
<span><span class="co">##   HMP2          583 357</span></span>
<span><span class="co">##   Lewis_2015    294  25</span></span>
<span><span class="co">##   metaHIT        21  71</span></span></code></pre></div>
<p>Some of the studies contain more than one sample for the same
subject. For example, the HMP2 publication focussed on the longitudinal
aspect of CD. Therefore. we want to take this into account when training
and evaluating the machine learning model (see the vignette about
<strong>Machine learning pitfalls</strong>) and when performing the
association testing. Thus, it will be convenient to create a second
metadata table containing a single entry for each individual.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta.ind</span> <span class="op">&lt;-</span> <span class="va">meta.all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Individual_ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Timepoint</span><span class="op">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">Timepoint</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="compare-associations">Compare Associations<a class="anchor" aria-label="anchor" href="#compare-associations"></a>
</h2>
<div class="section level3">
<h3 id="compute-associations-with-siamcat">Compute Associations with SIAMCAT<a class="anchor" aria-label="anchor" href="#compute-associations-with-siamcat"></a>
</h3>
<p>To test for associations, we can encapsulate each dataset into a
different <code>SIAMCAT</code> object and use the
<code>check.associations</code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">assoc.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="va">datasets</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># filter metadata and convert to dataframe</span></span>
<span>    <span class="va">meta.train</span> <span class="op">&lt;-</span> <span class="va">meta.ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Study</span><span class="op">==</span><span class="va">d</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta.train</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">meta.train</span><span class="op">$</span><span class="va">Sample_ID</span></span>
<span></span>
<span>    <span class="co"># create SIAMCAT object</span></span>
<span>    <span class="va">sc.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/siamcat.html">siamcat</a></span><span class="op">(</span>feat<span class="op">=</span><span class="va">feat</span>, meta<span class="op">=</span><span class="va">meta.train</span>, label<span class="op">=</span><span class="st">'Group'</span>, case<span class="op">=</span><span class="st">'CD'</span><span class="op">)</span></span>
<span>    <span class="co"># test for associations</span></span>
<span>    <span class="va">sc.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check.associations.html">check.associations</a></span><span class="op">(</span><span class="va">sc.obj</span>, log.n0<span class="op">=</span><span class="fl">1e-05</span>, </span>
<span>                                feature.type <span class="op">=</span> <span class="st">'original'</span><span class="op">)</span></span>
<span>    <span class="co"># extract the associations and save them in the assoc.list</span></span>
<span>    <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/associations-methods.html">associations</a></span><span class="op">(</span><span class="va">sc.obj</span><span class="op">)</span></span>
<span>    <span class="va">temp</span><span class="op">$</span><span class="va">genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span>    <span class="va">assoc.list</span><span class="op">[[</span><span class="va">d</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">genus</span>, <span class="va">fc</span>, <span class="va">auc</span>, <span class="va">p.adj</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Study<span class="op">=</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># combine all associations</span></span>
<span><span class="va">df.assoc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">assoc.list</span><span class="op">)</span></span>
<span><span class="va">df.assoc</span> <span class="op">&lt;-</span> <span class="va">df.assoc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span><span class="op">!=</span><span class="st">'unclassified'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df.assoc</span><span class="op">)</span></span>
<span><span class="co">##                                             genus fc auc p.adj   Study</span></span>
<span><span class="co">## 159730 Thermovenabulum...1 159730 Thermovenabulum  0 0.5   NaN metaHIT</span></span>
<span><span class="co">## 42447 Anaerobranca...2         42447 Anaerobranca  0 0.5   NaN metaHIT</span></span>
<span><span class="co">## 1562 Desulfotomaculum...3   1562 Desulfotomaculum  0 0.5   NaN metaHIT</span></span>
<span><span class="co">## 60919 Sanguibacter...4         60919 Sanguibacter  0 0.5   NaN metaHIT</span></span>
<span><span class="co">## 357 Agrobacterium...5           357 Agrobacterium  0 0.5   NaN metaHIT</span></span>
<span><span class="co">## 392332 Geoalkalibacter...6 392332 Geoalkalibacter  0 0.5   NaN metaHIT</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-heatmap-for-interesting-genera">Plot Heatmap for Interesting Genera<a class="anchor" aria-label="anchor" href="#plot-heatmap-for-interesting-genera"></a>
</h3>
<p>Now, we can compare the associations stored in the
<code>df.assoc</code> tibble. For example, we can extract features which
are very strongly associated with the label (single-feature AUROC &gt;
0.75 or &lt; 0.25) in at least one of the studies and plot the
generalized fold change as heatmap.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genera.of.interest</span> <span class="op">&lt;-</span> <span class="va">df.assoc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">genus</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">auc</span><span class="op">)</span>, n.filt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">auc</span> <span class="op">&lt;</span> <span class="fl">0.25</span> <span class="op">|</span> <span class="va">auc</span> <span class="op">&gt;</span> <span class="fl">0.75</span><span class="op">)</span>, </span>
<span>        .groups<span class="op">=</span><span class="st">'keep'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n.filt</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<p>After we extracted the genera, we plot them:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df.assoc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># take only genera of interest</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">genera.of.interest</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># convert to factor to enforce an ordering by mean AUC</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>genus<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">genus</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">genera.of.interest</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># convert to factor to enforce ordering again</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Study<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Study</span>, levels <span class="op">=</span> <span class="va">datasets</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># annotate the cells in the heatmap with stars</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>l<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">p.adj</span> <span class="op">&lt;</span> <span class="fl">0.01</span><span class="op">~</span><span class="st">'*'</span>, <span class="cn">TRUE</span><span class="op">~</span><span class="st">''</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">genus</span>, x<span class="op">=</span><span class="va">Study</span>, fill<span class="op">=</span><span class="va">fc</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">'#3B6FB6'</span>, high<span class="op">=</span><span class="st">'#D41645'</span>, mid <span class="op">=</span> <span class="st">'white'</span>, </span>
<span>            limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.7</span>, <span class="fl">2.7</span><span class="op">)</span>, name<span class="op">=</span><span class="st">'Generalized\nfold change'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">l</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="SIAMCAT_meta_files/figure-html/heatmap-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="study-as-confounding-factor">Study as Confounding Factor<a class="anchor" aria-label="anchor" href="#study-as-confounding-factor"></a>
</h2>
<p>Additionally, we can check how differences between studies might
influence the variance of specific genera. To do so, we create a singel
<code>SIAMCAT</code> object which holds the complete datasets and then
we run the <code>check.confounder</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df.meta</span> <span class="op">&lt;-</span> <span class="va">meta.ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">df.meta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">df.meta</span><span class="op">$</span><span class="va">Sample_ID</span></span>
<span><span class="va">sc.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/siamcat.html">siamcat</a></span><span class="op">(</span>feat<span class="op">=</span><span class="va">feat</span>, meta<span class="op">=</span><span class="va">df.meta</span>, label<span class="op">=</span><span class="st">'Group'</span>, case<span class="op">=</span><span class="st">'CD'</span><span class="op">)</span></span>
<span><span class="co">## + starting create.label</span></span>
<span><span class="co">## Label used as case:</span></span>
<span><span class="co">##    CD</span></span>
<span><span class="co">## Label used as control:</span></span>
<span><span class="co">##    CTR</span></span>
<span><span class="co">## + finished create.label.from.metadata in    0 s</span></span>
<span><span class="co">## + starting validate.data</span></span>
<span><span class="co">## +++ checking overlap between labels and features</span></span>
<span><span class="co">## + Keeping labels of 504 sample(s).</span></span>
<span><span class="co">## +++ checking sample number per class</span></span>
<span><span class="co">## +++ checking overlap between samples and metadata</span></span>
<span><span class="co">## + finished validate.data in 0.262 s</span></span>
<span><span class="fu"><a href="../reference/check.confounders.html">check.confounders</a></span><span class="op">(</span><span class="va">sc.obj</span>, fn.plot <span class="op">=</span> <span class="st">'./confounder_plot_cd_meta.pdf'</span>,</span>
<span>                feature.type<span class="op">=</span><span class="st">'original'</span><span class="op">)</span></span>
<span><span class="co">## Finished checking metadata for confounders, results plotted to: ./confounder_plot_cd_meta.pdf</span></span></code></pre></div>
<p><img src="confounder_plot_cd_meta.png"></p>
<p>The resulting variance plot shows that some genera are strongly
impacated by differences between studies, other genera not so much. Of
note, the genera that vary most with the label (CD vs controls) do not
show a lot of variance across studies.</p>
</div>
<div class="section level2">
<h2 id="ml-meta-analysis">ML Meta-analysis<a class="anchor" aria-label="anchor" href="#ml-meta-analysis"></a>
</h2>
<div class="section level3">
<h3 id="train-lasso-models">Train LASSO Models<a class="anchor" aria-label="anchor" href="#train-lasso-models"></a>
</h3>
<p>Lastly, we can perform the machine learning (ML) meta-analysis: we
first train one model for each datasets and then apply it to the other
datasets using the holdout testing functionality of
<code>SIAMCAT</code>. For datasets with repeated samples across
subjects, we block the cross-validation for subjects in order not to
bias the results (see also the vignette about <strong>Machine learning
pitfalls</strong>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create tibble to store all the predictions</span></span>
<span><span class="va">auroc.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>study.train<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, </span>
<span>                    study.test<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>                    AUC<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># and a list to save the trained SIAMCAT objects</span></span>
<span><span class="va">sc.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">datasets</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># restrict to a single study</span></span>
<span>    <span class="va">meta.train</span> <span class="op">&lt;-</span> <span class="va">meta.all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Study</span><span class="op">==</span><span class="va">i</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta.train</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">meta.train</span><span class="op">$</span><span class="va">Sample_ID</span></span>
<span></span>
<span>    <span class="co">## take into account repeated sampling by including a parameters</span></span>
<span>    <span class="co">## in the create.data.split function</span></span>
<span>    <span class="co">## For studies with repeated samples, we want to block the</span></span>
<span>    <span class="co">## cross validation by the column 'Individual_ID'</span></span>
<span>    <span class="va">block</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'metaHIT'</span>, <span class="st">'Lewis_2015'</span>, <span class="st">'HMP2'</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">block</span> <span class="op">&lt;-</span> <span class="st">'Individual_ID'</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="st">'HMP2'</span><span class="op">)</span><span class="op">{</span> </span>
<span>            <span class="co"># for the HMP2 dataset, the number of repeated sample per subject </span></span>
<span>            <span class="co"># need to be reduced, because some subjects have been sampled </span></span>
<span>            <span class="co"># 20 times, other only 5 times</span></span>
<span>            <span class="va">meta.train</span> <span class="op">&lt;-</span> <span class="va">meta.all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Study</span><span class="op">==</span><span class="st">'HMP2'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Individual_ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">5</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta.train</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">meta.train</span><span class="op">$</span><span class="va">Sample_ID</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="co"># create SIAMCAT object</span></span>
<span>    <span class="va">sc.obj.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/siamcat.html">siamcat</a></span><span class="op">(</span>feat<span class="op">=</span><span class="va">feat</span>, meta<span class="op">=</span><span class="va">meta.train</span>, </span>
<span>                            label<span class="op">=</span><span class="st">'Group'</span>, case<span class="op">=</span><span class="st">'CD'</span><span class="op">)</span></span>
<span>    <span class="co"># normalize features</span></span>
<span>    <span class="va">sc.obj.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normalize.features.html">normalize.features</a></span><span class="op">(</span><span class="va">sc.obj.train</span>, norm.method <span class="op">=</span> <span class="st">'log.std'</span>,</span>
<span>        norm.param<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>log.n0<span class="op">=</span><span class="fl">1e-05</span>, sd.min.q<span class="op">=</span><span class="fl">0</span><span class="op">)</span>,feature.type <span class="op">=</span> <span class="st">'original'</span><span class="op">)</span></span>
<span>    <span class="co"># Create data split</span></span>
<span>    <span class="va">sc.obj.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.data.split.html">create.data.split</a></span><span class="op">(</span><span class="va">sc.obj.train</span>,</span>
<span>        num.folds <span class="op">=</span> <span class="fl">10</span>, num.resample <span class="op">=</span> <span class="fl">10</span>, inseparable <span class="op">=</span> <span class="va">block</span><span class="op">)</span></span>
<span>    <span class="co"># train LASSO model</span></span>
<span>    <span class="va">sc.obj.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.model.html">train.model</a></span><span class="op">(</span><span class="va">sc.obj.train</span>, method<span class="op">=</span><span class="st">'lasso'</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">## apply trained models to other datasets</span></span>
<span></span>
<span>    <span class="co"># loop through datasets again</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i2</span> <span class="kw">in</span> <span class="va">datasets</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="va">i2</span><span class="op">)</span><span class="op">{</span></span>
<span>            <span class="co"># make and evaluate cross-validation predictions (same dataset)</span></span>
<span>            <span class="va">sc.obj.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.predictions.html">make.predictions</a></span><span class="op">(</span><span class="va">sc.obj.train</span><span class="op">)</span></span>
<span>            <span class="va">sc.obj.train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.predictions.html">evaluate.predictions</a></span><span class="op">(</span><span class="va">sc.obj.train</span><span class="op">)</span></span>
<span>            <span class="va">auroc.all</span> <span class="op">&lt;-</span> <span class="va">auroc.all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span>study.train<span class="op">=</span><span class="va">i</span>, study.test<span class="op">=</span><span class="va">i</span>,</span>
<span>                    AUC<span class="op">=</span><span class="fu"><a href="../reference/eval_data-methods.html">eval_data</a></span><span class="op">(</span><span class="va">sc.obj.train</span><span class="op">)</span><span class="op">$</span><span class="va">auroc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="co"># make and evaluate on the external datasets</span></span>
<span>            <span class="co"># use meta.ind here, since we want only one sample per subject!</span></span>
<span>            <span class="va">meta.test</span> <span class="op">&lt;-</span> <span class="va">meta.ind</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Study</span><span class="op">==</span><span class="va">i2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta.test</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">meta.test</span><span class="op">$</span><span class="va">Sample_ID</span></span>
<span>            <span class="va">sc.obj.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/siamcat.html">siamcat</a></span><span class="op">(</span>feat<span class="op">=</span><span class="va">feat</span>, meta<span class="op">=</span><span class="va">meta.test</span>,</span>
<span>                                    label<span class="op">=</span><span class="st">'Group'</span>, case<span class="op">=</span><span class="st">'CD'</span><span class="op">)</span></span>
<span>            <span class="co"># make holdout predictions</span></span>
<span>            <span class="va">sc.obj.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make.predictions.html">make.predictions</a></span><span class="op">(</span><span class="va">sc.obj.train</span>, </span>
<span>                                            siamcat.holdout <span class="op">=</span> <span class="va">sc.obj.test</span><span class="op">)</span></span>
<span>            <span class="va">sc.obj.test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.predictions.html">evaluate.predictions</a></span><span class="op">(</span><span class="va">sc.obj.test</span><span class="op">)</span></span>
<span>            <span class="va">auroc.all</span> <span class="op">&lt;-</span> <span class="va">auroc.all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                <span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span>study.train<span class="op">=</span><span class="va">i</span>, study.test<span class="op">=</span><span class="va">i2</span>,</span>
<span>                    AUC<span class="op">=</span><span class="fu"><a href="../reference/eval_data-methods.html">eval_data</a></span><span class="op">(</span><span class="va">sc.obj.test</span><span class="op">)</span><span class="op">$</span><span class="va">auroc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="co"># save the trained model</span></span>
<span>    <span class="va">sc.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sc.obj.train</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>After we trained and applied all models, we can calculate the test
average for each dataset:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test.average</span> <span class="op">&lt;-</span> <span class="va">auroc.all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">study.train</span><span class="op">!=</span><span class="va">study.test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">study.test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>AUC<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">AUC</span><span class="op">)</span>, .groups<span class="op">=</span><span class="st">'drop'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>study.train<span class="op">=</span><span class="st">"Average"</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have the AUROC values, we can plot them into a nice
heatmap:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># combine AUROC values with test average</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">auroc.all</span>, <span class="va">test.average</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># highlight cross validation versus transfer results</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>CV<span class="op">=</span><span class="va">study.train</span> <span class="op">==</span> <span class="va">study.test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># for facetting later</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>split<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">study.train</span><span class="op">==</span><span class="st">'Average'</span><span class="op">~</span><span class="st">'Average'</span>, <span class="cn">TRUE</span><span class="op">~</span><span class="st">'none'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>split<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">split</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'none'</span>, <span class="st">'Average'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># convert to factor to enforce ordering</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>study.train<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">study.train</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">datasets</span>, <span class="st">'Average'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>study.test<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">study.test</span>, </span>
<span>                            levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span>,<span class="st">'Average'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">study.test</span>, x<span class="op">=</span><span class="va">study.train</span>, fill<span class="op">=</span><span class="va">AUC</span>, size<span class="op">=</span><span class="va">CV</span>, color<span class="op">=</span><span class="va">CV</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="co"># text in tiles</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html" class="external-link">aes_string</a></span><span class="op">(</span>label<span class="op">=</span><span class="st">"format(AUC, digits=2)"</span><span class="op">)</span>, </span>
<span>            col<span class="op">=</span><span class="st">'white'</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>        <span class="co"># color scheme</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'darkgreen'</span>,<span class="st">'forestgreen'</span>, </span>
<span>                                        <span class="st">'chartreuse3'</span>,<span class="st">'lawngreen'</span>, </span>
<span>                                        <span class="st">'yellow'</span><span class="op">)</span><span class="op">)</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="co"># axis position/remove boxes/ticks/facet background/etc.</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>position<span class="op">=</span><span class="st">'top'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                axis.text.x.top <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">45</span>, hjust<span class="op">=</span><span class="fl">.1</span><span class="op">)</span>, </span>
<span>                panel.grid<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                panel.border<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Training Set'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Test Set'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#FFFFFF00'</span>, <span class="st">'grey'</span><span class="op">)</span>, guide<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_size_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, guide<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">split</span>, scales <span class="op">=</span> <span class="st">'free'</span>, space <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span></span>
<span><span class="co">## Warning: `aes_string()` was deprecated in ggplot2 3.0.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use tidy evaluation ideoms with `aes()`</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">## Warning: The `guide` argument in `scale_*()` cannot be `FALSE`. This was deprecated in</span></span>
<span><span class="co">## ggplot2 3.3.4.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use "none" instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="SIAMCAT_meta_files/figure-html/plot_auroc-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="investigate-feature-weights">Investigate Feature Weights<a class="anchor" aria-label="anchor" href="#investigate-feature-weights"></a>
</h3>
<p>Now that we the trained models (and we saved them in the
<code>sc.list</code> object), we can also extract the model weights
using <code>SIAMCAT</code> and compare to the associations we computed
above.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weight.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">d</span> <span class="kw">in</span> <span class="va">datasets</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">sc.obj.train</span> <span class="op">&lt;-</span> <span class="va">sc.list</span><span class="op">[[</span><span class="va">d</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="co"># extract the feature weights out of the SIAMCAT object</span></span>
<span>    <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/feature_weights-methods.html">feature_weights</a></span><span class="op">(</span><span class="va">sc.obj.train</span><span class="op">)</span></span>
<span>    <span class="va">temp</span><span class="op">$</span><span class="va">genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span>    <span class="co"># save selected info in the weight.list</span></span>
<span>    <span class="va">weight.list</span><span class="op">[[</span><span class="va">d</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">genus</span>, <span class="va">median.rel.weight</span>, <span class="va">mean.rel.weight</span>, <span class="va">percentage</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Study<span class="op">=</span><span class="va">d</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>r.med<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">median.rel.weight</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            r.mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">mean.rel.weight</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># combine all feature weights into a single tibble</span></span>
<span><span class="va">df.weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">weight.list</span><span class="op">)</span></span>
<span><span class="va">df.weights</span> <span class="op">&lt;-</span> <span class="va">df.weights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span><span class="op">!=</span><span class="st">'unclassified'</span><span class="op">)</span></span></code></pre></div>
<p>Using this, we can plot another heatmap with the weights, focussing
on the genera of interest for which we plotted the associations as
heatmap above.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute absolute feature weights</span></span>
<span><span class="va">abs.weights</span> <span class="op">&lt;-</span> <span class="va">df.weights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Study</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>sum.median<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">median.rel.weight</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                sum.mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">mean.rel.weight</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                .groups<span class="op">=</span><span class="st">'drop'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df.weights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">abs.weights</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># normalize by the absolute model size</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>median.rel.weight<span class="op">=</span><span class="va">median.rel.weight</span><span class="op">/</span><span class="va">sum.median</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># only include genera of interest</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">genera.of.interest</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="co"># highlight feature rank for the top 20 features</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>r.med<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">r.med</span> <span class="op">&gt;</span> <span class="fl">20</span><span class="op">~</span><span class="cn">NA_real_</span>, <span class="cn">TRUE</span><span class="op">~</span><span class="va">r.med</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># enforce the correct ordering by converting to factors again</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>genus<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">genus</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">genera.of.interest</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Study<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Study</span>, levels <span class="op">=</span> <span class="va">datasets</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">genus</span>, x<span class="op">=</span><span class="va">Study</span>, fill<span class="op">=</span><span class="va">median.rel.weight</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'#007A53'</span>, <span class="st">'#009F4D'</span>, <span class="st">"#6CC24A"</span>, <span class="st">'white'</span>,</span>
<span>            <span class="st">"#EFC06E"</span>, <span class="st">"#FFA300"</span>, <span class="st">'#BE5400'</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.15</span>, <span class="fl">0.15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">r.med</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'black'</span>, size<span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">''</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Joining with `by = join_by(Study)`</span></span></code></pre></div>
<p><img src="SIAMCAT_meta_files/figure-html/plot_weights_heatmap-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## R version 4.2.2 (2022-10-31)</span></span>
<span><span class="co">## Platform: x86_64-apple-darwin17.0 (64-bit)</span></span>
<span><span class="co">## Running under: macOS Big Sur ... 10.16</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib</span></span>
<span><span class="co">## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] SIAMCAT_2.3.3    phyloseq_1.42.0  mlr3_0.14.1      lubridate_1.9.2 </span></span>
<span><span class="co">##  [5] forcats_1.0.0    stringr_1.5.0    dplyr_1.1.0      purrr_1.0.1     </span></span>
<span><span class="co">##  [9] readr_2.1.4      tidyr_1.3.0      tibble_3.2.0     ggplot2_3.4.1   </span></span>
<span><span class="co">## [13] tidyverse_2.0.0  BiocStyle_2.26.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] uuid_1.1-0             backports_1.4.1        corrplot_0.92         </span></span>
<span><span class="co">##   [4] systemfonts_1.0.4      plyr_1.8.8             igraph_1.4.1          </span></span>
<span><span class="co">##   [7] splines_4.2.2          listenv_0.9.0          GenomeInfoDb_1.34.9   </span></span>
<span><span class="co">##  [10] gridBase_0.4-7         digest_0.6.31          foreach_1.5.2         </span></span>
<span><span class="co">##  [13] htmltools_0.5.4        lmerTest_3.1-3         fansi_1.0.4           </span></span>
<span><span class="co">##  [16] magrittr_2.0.3         checkmate_2.1.0        memoise_2.0.1         </span></span>
<span><span class="co">##  [19] cluster_2.1.4          tzdb_0.3.0             globals_0.16.2        </span></span>
<span><span class="co">##  [22] Biostrings_2.66.0      mlr3tuning_0.18.0      matrixStats_0.63.0    </span></span>
<span><span class="co">##  [25] vroom_1.6.1            timechange_0.2.0       pkgdown_2.0.7         </span></span>
<span><span class="co">##  [28] prettyunits_1.1.1      colorspace_2.1-0       textshaping_0.3.6     </span></span>
<span><span class="co">##  [31] xfun_0.37              crayon_1.5.2           RCurl_1.98-1.10       </span></span>
<span><span class="co">##  [34] jsonlite_1.8.4         lme4_1.1-32            survival_3.5-5        </span></span>
<span><span class="co">##  [37] iterators_1.0.14       ape_5.7-1              glue_1.6.2            </span></span>
<span><span class="co">##  [40] gtable_0.3.1           zlibbioc_1.44.0        XVector_0.38.0        </span></span>
<span><span class="co">##  [43] Rhdf5lib_1.20.0        shape_1.4.6            BiocGenerics_0.44.0   </span></span>
<span><span class="co">##  [46] scales_1.2.1           infotheo_1.2.0.1       DBI_1.1.3             </span></span>
<span><span class="co">##  [49] Rcpp_1.0.10            progress_1.2.2         palmerpenguins_0.1.1  </span></span>
<span><span class="co">##  [52] bit_4.0.5              stats4_4.2.2           glmnet_4.1-6          </span></span>
<span><span class="co">##  [55] RColorBrewer_1.1-3     ellipsis_0.3.2         farver_2.1.1          </span></span>
<span><span class="co">##  [58] pkgconfig_2.0.3        sass_0.4.5             utf8_1.2.3            </span></span>
<span><span class="co">##  [61] labeling_0.4.2         tidyselect_1.2.0       rlang_1.1.0           </span></span>
<span><span class="co">##  [64] reshape2_1.4.4         PRROC_1.3.1            munsell_0.5.0         </span></span>
<span><span class="co">##  [67] tools_4.2.2            cachem_1.0.7           cli_3.6.0             </span></span>
<span><span class="co">##  [70] generics_0.1.3         ade4_1.7-22            evaluate_0.20         </span></span>
<span><span class="co">##  [73] biomformat_1.26.0      fastmap_1.1.1          yaml_2.3.7            </span></span>
<span><span class="co">##  [76] ragg_1.2.5             bit64_4.0.5            knitr_1.42            </span></span>
<span><span class="co">##  [79] fs_1.6.1               lgr_0.4.4              beanplot_1.3.1        </span></span>
<span><span class="co">##  [82] bbotk_0.7.2            future_1.32.0          nlme_3.1-162          </span></span>
<span><span class="co">##  [85] paradox_0.11.0         compiler_4.2.2         rstudioapi_0.14       </span></span>
<span><span class="co">##  [88] curl_5.0.0             bslib_0.4.2            stringi_1.7.12        </span></span>
<span><span class="co">##  [91] highr_0.10             desc_1.4.2             lattice_0.20-45       </span></span>
<span><span class="co">##  [94] Matrix_1.5-3           nloptr_2.0.3           vegan_2.6-4           </span></span>
<span><span class="co">##  [97] permute_0.9-7          multtest_2.54.0        vctrs_0.5.2           </span></span>
<span><span class="co">## [100] pillar_1.8.1           lifecycle_1.0.3        rhdf5filters_1.10.0   </span></span>
<span><span class="co">## [103] BiocManager_1.30.20    jquerylib_0.1.4        LiblineaR_2.10-22     </span></span>
<span><span class="co">## [106] data.table_1.14.8      bitops_1.0-7           R6_2.5.1              </span></span>
<span><span class="co">## [109] bookdown_0.33          gridExtra_2.3          mlr3misc_0.11.0       </span></span>
<span><span class="co">## [112] IRanges_2.32.0         parallelly_1.34.0      codetools_0.2-19      </span></span>
<span><span class="co">## [115] boot_1.3-28.1          MASS_7.3-58.3          rhdf5_2.42.0          </span></span>
<span><span class="co">## [118] mlr3learners_0.5.6     rprojroot_2.0.3        withr_2.5.0           </span></span>
<span><span class="co">## [121] S4Vectors_0.36.2       GenomeInfoDbData_1.2.9 mgcv_1.8-42           </span></span>
<span><span class="co">## [124] parallel_4.2.2         hms_1.1.2              grid_4.2.2            </span></span>
<span><span class="co">## [127] minqa_1.2.5            rmarkdown_2.20         pROC_1.18.0           </span></span>
<span><span class="co">## [130] numDeriv_2016.8-1.1    Biobase_2.58.0</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Konrad Zych, Jakob Wirbel, Georg Zeller.</p>
</div>

<div class="privacy">
  <p><strong>Privacy:</strong> Usage of this site follows
      <a href="https://www.embl.de/aboutus/privacy_policy/index.html" class="external-link">EMBL’s Privacy Policy</a><br>
      In accordance with that policy, we use Matomo to collect anonymised data on visits to, downloads from, and searches of this site.
      Contact <a href="mailto:zeller@embl.de">Georg Zeller</a> for details.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
